<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XR Labs | Gesture Cursor Control</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handtrackjs/dist/handtrack.min.js"></script>

    <style>
        :root {
            --bg-color: #0f0f0f;
            --text-color: #ffffff;
            --accent-color: #6366f1;
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-color); overflow-x: hidden; }

        /* --- Hand-Controlled Cursor --- */
        #cursor { 
            position: fixed; 
            width: 25px; 
            height: 25px; 
            background: #fff; 
            border-radius: 50%; 
            pointer-events: none; 
            z-index: 9999; 
            mix-blend-mode: difference;
            transition: transform 0.1s ease, background 0.2s ease;
        }
        
        #cursor.clicking {
            transform: scale(0.5);
            background: var(--accent-color);
        }

        nav { position: fixed; top: 0; width: 100%; padding: 30px 50px; display: flex; justify-content: space-between; z-index: 100; }
        .logo { font-weight: 700; letter-spacing: -1px; font-size: 1.2rem; }

        section { padding: 100px 10%; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; position: relative; }
        h1 { font-size: 5rem; font-weight: 700; line-height: 1.1; margin-bottom: 20px;}

        /* --- UI Elements --- */
        .cam-btn { 
            background: var(--accent-color); 
            color: white; border: none; 
            padding: 15px 30px; border-radius: 30px; 
            font-weight: bold; cursor: pointer; 
            margin-bottom: 20px;
        }

        .video-hud {
            position: relative;
            width: 480px; height: 360px;
            border-radius: 20px; border: 2px solid var(--accent-color);
            background: #000; overflow: hidden; display: none;
        }

        #v-preview { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }

        .model-card { width: 100%; height: 600px; background: rgba(255,255,255,0.03); border-radius: 40px; border: 1px solid var(--glass-border); position: relative; }
        model-viewer { width: 100%; height: 100%; }
    </style>
</head>
<body>

    <div id="cursor"></div>

    <nav>
        <div class="logo">XR TRAINING LABS</div>
        <div class="menu">GESTURE NAV ACTIVE</div>
    </nav>

    <section>
        <h1>Hand-Tracked<br>Cursor Interface</h1>
        <p style="margin-bottom: 30px; color: #888;">Enable the camera to control the global cursor with your hand. <b>Fist</b> to click/interact.</p>
        
        <button class="cam-btn" id="t-btn">INITIALIZING AI...</button>
        <div class="video-hud" id="hud-container">
            <video id="v-preview" autoplay></video>
        </div>
    </section>

    <section class="section-model">
        <div class="model-card">
            <model-viewer id="xr-model" src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb" camera-controls shadow-intensity="1">
            </model-viewer>
        </div>
    </section>

    <script>
        const video = document.getElementById("v-preview");
        const hud = document.getElementById("hud-container");
        const cursor = document.getElementById('cursor');
        const trackBtn = document.getElementById("t-btn");
        let isTracking = false;
        let detectionModel = null;

        // Load Handtrack AI
        handTrack.load({ flipHorizontal: true, maxNumBoxes: 1, scoreThreshold: 0.6 }).then(m => {
            detectionModel = m;
            trackBtn.innerText = "START GESTURE CURSOR";
        });

        trackBtn.addEventListener("click", () => {
            if (!isTracking) {
                handTrack.startVideo(video).then(status => {
                    if (status) {
                        isTracking = true;
                        hud.style.display = "block";
                        trackBtn.innerText = "DISABLE GESTURES";
                        detect();
                    }
                });
            } else {
                handTrack.stopVideo(video);
                isTracking = false;
                hud.style.display = "none";
                trackBtn.innerText = "START GESTURE CURSOR";
            }
        });

        function detect() {
            detectionModel.detect(video).then(predictions => {
                if (predictions.length > 0) {
                    const hand = predictions[0];
                    const [x, y, w, h] = hand.bbox;
                    
                    // Map video coordinates (480x360) to screen coordinates (Viewport)
                    const screenX = ((x + w/2) / 480) * window.innerWidth;
                    const screenY = ((y + h/2) / 360) * window.innerHeight;

                    // Smooth cursor movement with GSAP
                    gsap.to(cursor, {
                        x: screenX,
                        y: screenY,
                        duration: 0.1,
                        ease: "power2.out"
                    });

                    // Gesture Click: "closed" or "fist" labels
                    if (hand.label === "closed" || hand.label === "fist") {
                        cursor.classList.add('clicking');
                    } else {
                        cursor.classList.remove('clicking');
                    }
                }
                if (isTracking) requestAnimationFrame(detect);
            });
        }

        // Standard mouse fallback
        document.addEventListener('mousemove', (e) => {
            if (!isTracking) {
                gsap.to(cursor, { x: e.clientX, y: e.clientY, duration: 0.1 });
            }
        });
    </script>
</body>
</html>
